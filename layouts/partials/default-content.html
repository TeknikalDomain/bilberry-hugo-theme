<div class="content">
    <h1 class="article-title">
        <a href="{{ .ctx.Permalink }}">
            {{ .ctx.Title }}
        </a>
    </h1>

    {{ if or (.ctx.Params.chips) (and .ctx.Params.narration (or (eq .template_type "single") (.ctx.Params.noSummary))) }}
    <div class="meta with-extras">
    {{ else }}
    <div class="meta">
    {{ end }}
        {{ if ( .ctx.Params.showDate | default true ) }}
            {{ if ( .ctx.Site.Params.enableMomentJs | default true ) }}
                <span class="date moment">{{ .ctx.PublishDate.Format "2006-01-02" }}</span>
            {{ else }}
                <span class="date">{{ .ctx.PublishDate.Format (.ctx.Site.Params.DateFormat | default "2006-01-02") }}</span>
            {{ end }}
        {{ end }}

        {{ if ( .ctx.Site.Params.showReadingTime | default false ) }}
            {{ if .ctx.Params.readingTime }}
                <span class="readingTime">{{ i18n "readingTime" .ctx.Params.readingTime }}</span>
            {{ else }}
                <span class="readingTime">{{ i18n "readingTime" .ctx.ReadingTime }}</span>
            {{ end }}
        {{ end }}

        {{ with .ctx.Params.categories }}
            <span class="categories">
                {{ range . }}
                    {{ $urlValue := replace . " " "-" | lower}}
                    {{ with $.ctx.Site.GetPage (printf "/categories/%s" $urlValue) }}
                        <a href="{{ .Permalink }}">{{ .Title }}</a>
                    {{ end }}
                {{ end }}
            </span>
        {{ end }}

        {{ with .ctx.Params.author }}
            <span class="author">
                {{ $urlValue := replace . " " "-" | lower}}
                {{ with $.ctx.Site.GetPage (printf "/author/%s" $urlValue ) }}
                    <a href="{{ .Permalink }}">{{ .Title }}</a>
                {{ end }}
            </span>
        {{ end }}

        {{ if .ctx.Params.showComments | default true }}
            <span><a href="{{ .ctx.Permalink }}#commento">Unable to load comment count</a></span>
        {{ end }}
    </div>

    {{ if or (.ctx.Params.chips) (and .ctx.Params.narration (or (eq .template_type "single") (.ctx.Params.noSummary))) }}
    <div class="article-extras">
        {{ if .ctx.Params.chips }}
        <div class="chips">
            {{ with .ctx.Params.chips.part }}
            <span class="chip">
            <span class="chip-left">Part</span>
            <span class="chip-right">{{ . }}</span>
            </span>
            {{ end }}
            {{ with .ctx.Params.chips.lastUpdate }}
            <span class="chip">
            <span class="chip-left">Updated</span>
            <span class="chip-right">{{ . }}</span>
            </span>
            {{ end }}
            {{ if .ctx.Params.chips.needsRework }}
            <a href="/page/needs-rework">
            <span class="simple-chip" id="rework-chip">
            Needs rework
            </span>
            </a>
            {{ end }}
            {{ with .ctx.Params.chips.outdated }}
            <a href="{{ . }}">
            <span class="simple-chip" id="outdated-chip">Outdated</span>
            </a>
            {{ end }}
            {{ if .ctx.Params.chips.improved }}
            <span class="simple-chip" id="improved-chip">New and improved!</span>
            {{ end }}
        </div>
        {{ if and .ctx.Params.narration (or (eq .template_type "single") (.ctx.Params.noSummary)) }}
                <hr />
        {{ end }}
        {{ end }}
        {{ if and .ctx.Params.narration (or (eq .template_type "single") (.ctx.Params.noSummary)) }}
        <div class="narration-container">
            <table>
                <tr>
                    <td>
                        This article has narration:<br />
                        (Press the 'p' key to toggle playback)
                    </td>
                    <td>
                        <audio controls preload="metadata" id="narration-player">
                            <source src="{{ .ctx.Params.narration }}" />
                            <p>Your browser does not support the HTML5 <code>&lt;audio&gt;</code> element, it seems, so this isn't available.</p>
                        </audio>
                    </td>
                </tr>
            </table>
        </div>
        {{ end }}
    </div>
    {{ end }}

    {{ if or (eq .template_type "single") (.ctx.Params.noSummary) }}
        {{ if and (gt .ctx.WordCount .ctx.Site.Params.tocMinWordCount ) (.ctx.Params.toc) }}
            <h2>{{ i18n "tableOfContents" | default "tableOfContents" }}</h2>
            {{ .ctx.TableOfContents }}
        {{ end }}

        {{ .ctx.Content }}
    {{ else }}
        {{ .ctx.Summary }}

        {{ if .ctx.Truncated }}
            <a href="{{ .ctx.Permalink }}" class="more">{{ i18n "continueReading" }}</a>
        {{ end }}
    {{ end }}
</div>
